<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>éª‘æ‰‹ç«¯ - ç ”ç©¶é—®å·</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
      background: #F5F5F5;
      min-height: 100vh;
    }
    
    .app-container {
      max-width: 500px;
      margin: 0 auto;
      min-height: 100vh;
      background: #F5F5F5;
      position: relative;
    }
    
    .page { display: none; min-height: 100vh; flex-direction: column; }
    .page.active { display: flex; }
    
    :root {
      --primary: #FFD000;
      --primary-dark: #FFC300;
      --primary-light: #FFF8E1;
      --secondary: #222222;
      --gradient: linear-gradient(180deg, #FFD000 0%, #FFC300 100%);
      --header-gradient: linear-gradient(180deg, #FFE14D 0%, #FFD000 50%, #FFC300 100%);
      --text: #222222;
      --text-secondary: #666666;
      --success: #00C853;
      --danger: #FF3B30;
    }
    
    .header {
      background: var(--header-gradient);
      padding: 50px 20px 20px;
      color: var(--secondary);
    }
    .header h2 { margin: 0; font-size: 20px; font-weight: 600; }
    .header p { margin: 8px 0 0; font-size: 13px; opacity: 0.8; }
    
    .content { flex: 1; overflow-y: auto; padding: 20px; }
    .footer { padding: 20px; padding-bottom: 40px; background: #fff; }
    
    .btn {
      width: 100%;
      padding: 16px;
      border: none;
      border-radius: 8px;
      font-size: 17px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }
    .btn-primary { background: var(--secondary); color: #fff; }
    .btn-primary:disabled { background: #ccc; cursor: not-allowed; }
    .btn-yellow { background: var(--primary); color: var(--secondary); font-weight: 700; }
    
    .card {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 15px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    }
    
    .option {
      padding: 14px 16px;
      background: #f8f8f8;
      border: 2px solid transparent;
      border-radius: 8px;
      cursor: pointer;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      transition: all 0.2s;
    }
    .option:active { transform: scale(0.98); }
    .option.selected { background: var(--primary-light); border-color: var(--primary); }
    .option-radio {
      width: 20px; height: 20px;
      border-radius: 50%;
      border: 2px solid #ddd;
      margin-right: 12px;
      display: flex; align-items: center; justify-content: center;
      flex-shrink: 0;
    }
    .option.selected .option-radio { border-color: var(--primary-dark); }
    .option.selected .option-radio::after {
      content: ''; width: 10px; height: 10px;
      border-radius: 50%; background: var(--primary-dark);
    }
    .option-text { font-size: 14px; color: var(--text); line-height: 1.5; }
    
    .likert-scale { display: flex; justify-content: space-between; align-items: flex-start; }
    .likert-item { display: flex; flex-direction: column; align-items: center; cursor: pointer; flex: 1; }
    .likert-circle {
      width: 44px; height: 44px; border-radius: 50%;
      background: #f0f0f0; border: 2px solid #ddd;
      display: flex; align-items: center; justify-content: center;
      font-size: 16px; font-weight: 600; color: var(--text-secondary);
      transition: all 0.2s;
    }
    .likert-item:active .likert-circle { transform: scale(0.95); }
    .likert-item.selected .likert-circle {
      background: var(--primary); border-color: var(--primary-dark); color: var(--secondary);
    }
    .likert-label { font-size: 10px; color: var(--text-secondary); margin-top: 6px; text-align: center; height: 26px; }
    
    .progress-bar { height: 4px; background: rgba(0,0,0,0.1); border-radius: 2px; overflow: hidden; margin-top: 12px; }
    .progress-fill { height: 100%; background: var(--secondary); border-radius: 2px; transition: width 0.3s ease; }
    
    .notification-header {
      background: linear-gradient(180deg, #FFD000 0%, #FFC300 100%);
      padding: 20px; color: var(--secondary); text-align: center;
      border-radius: 12px 12px 0 0;
    }
    .notification-body { padding: 20px; }
    .data-card { background: #F8F8F8; border-radius: 8px; padding: 16px; margin-bottom: 16px; }
    .data-item {
      display: flex; align-items: center; justify-content: space-between;
      padding: 10px 12px; background: #fff; border-radius: 6px; margin-bottom: 8px;
    }
    .data-item:last-child { margin-bottom: 0; }
    
    .result-box {
      background: linear-gradient(135deg, #FFF5F5 0%, #FFF 100%);
      border-radius: 8px; padding: 20px; border: 2px solid #FF3B30;
      text-align: center; margin-bottom: 16px;
    }
    .star-change { display: flex; align-items: center; justify-content: center; gap: 20px; margin: 16px 0; }
    .star-old { font-size: 24px; font-weight: 700; color: var(--success); }
    .star-new { font-size: 24px; font-weight: 700; color: var(--danger); }
    
    .explanation-box { border-radius: 8px; padding: 16px; margin-bottom: 16px; }
    .explanation-feature { background: #E8F4FD; border: 1px solid #90CAF9; }
    .explanation-counterfactual { background: #F3E8FD; border: 1px solid #CE93D8; }
    .explanation-context { background: #E8FDF5; border: 1px solid #A5D6A7; }
    .weight-stars { color: #FFD000; }
    .tip-box { background: var(--primary-light); border-radius: 8px; padding: 16px; text-align: center; }
    
    .complete-page {
      background: var(--header-gradient);
      justify-content: center; align-items: center; text-align: center; padding: 40px;
    }
    .complete-icon {
      width: 120px; height: 120px; background: #fff; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      margin-bottom: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); font-size: 60px;
    }
    
    input[type="text"], input[type="number"] {
      width: 100%; padding: 14px 16px; border: 2px solid #eee;
      border-radius: 8px; font-size: 15px; outline: none;
    }
    input:focus { border-color: var(--primary); }
    
    .loading-overlay {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(255,255,255,0.9);
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      z-index: 1000;
    }
    .loading-spinner {
      width: 40px; height: 40px; border: 4px solid #f0f0f0;
      border-top-color: var(--primary); border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    
    .overlap-option {
      display: flex; align-items: center; justify-content: space-between;
      padding: 12px 16px; background: #f8f8f8; border: 2px solid transparent;
      border-radius: 8px; cursor: pointer; margin-bottom: 8px; transition: all 0.2s;
    }
    .overlap-option:active { transform: scale(0.98); }
    .overlap-option.selected { background: var(--primary-light); border-color: var(--primary); }
    .overlap-circles { display: flex; align-items: center; position: relative; }
    .circle-self {
      width: 40px; height: 40px; border-radius: 50%;
      background: var(--primary); border: 2px solid var(--primary-dark);
      position: relative; z-index: 2;
    }
    .circle-future {
      width: 40px; height: 40px; border-radius: 50%;
      background: var(--secondary); border: 2px solid #000;
      position: relative; z-index: 1;
    }
  </style>
</head>
<body>
  <div class="app-container" id="app">
    <div class="loading-overlay" id="loading">
      <div class="loading-spinner"></div>
      <p style="margin-top: 16px; color: #666;">æ­£åœ¨åˆå§‹åŒ–...</p>
    </div>
  </div>

  <script>
    // ==================== é…ç½®åŒºåŸŸ ====================
    const CONFIG = {
      PLATFORM: 'meituan',
      PLATFORM_NAME: 'è¯¥å¹³å°',
      DATA_ENDPOINT: 'https://1395241645-blt3k01y8r.ap-guangzhou.tencentscf.com',
      BACKUP_ENDPOINT: '',
      DEBUG: false
    };
    
    // å®éªŒæ¡ä»¶
    const CONDITIONS = [
      { key: 'no_explanation_high', explanation: 'none', contextAwareness: 'high' },
      { key: 'no_explanation_low', explanation: 'none', contextAwareness: 'low' },
      { key: 'feature_importance_high', explanation: 'feature', contextAwareness: 'high' },
      { key: 'feature_importance_low', explanation: 'feature', contextAwareness: 'low' },
      { key: 'counterfactual_high', explanation: 'counterfactual', contextAwareness: 'high' },
      { key: 'counterfactual_low', explanation: 'counterfactual', contextAwareness: 'low' },
    ];

    // ==================== è®¾å¤‡ä¿¡æ¯æ”¶é›† ====================
    async function generateDeviceInfo() {
      const deviceInfo = {
        deviceId: '',
        fingerprint: '',
        userAgent: navigator.userAgent,
        platform: navigator.platform,
        language: navigator.language,
        screenWidth: screen.width,
        screenHeight: screen.height,
        colorDepth: screen.colorDepth,
        timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
        timezoneOffset: new Date().getTimezoneOffset(),
        location: null,
        locationError: null,
        referrer: document.referrer,
        url: window.location.href
      };
      
      try {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = 200; canvas.height = 50;
        ctx.textBaseline = 'top';
        ctx.font = '14px Arial';
        ctx.fillStyle = '#f60';
        ctx.fillRect(0, 0, 200, 50);
        ctx.fillStyle = '#069';
        ctx.fillText('XAIç ”ç©¶', 2, 15);
        deviceInfo.fingerprint = canvas.toDataURL().slice(-50);
      } catch (e) {
        deviceInfo.fingerprint = 'not_supported';
      }
      
      const idSource = [deviceInfo.userAgent, deviceInfo.screenWidth, deviceInfo.screenHeight, 
                        deviceInfo.colorDepth, deviceInfo.timezone, deviceInfo.fingerprint].join('|');
      deviceInfo.deviceId = 'D' + hashCode(idSource).toString(36).toUpperCase();
      
      if (navigator.geolocation) {
        try {
          const position = await new Promise((resolve, reject) => {
            navigator.geolocation.getCurrentPosition(resolve, reject, {
              enableHighAccuracy: false, timeout: 10000, maximumAge: 300000
            });
          });
          deviceInfo.location = {
            latitude: position.coords.latitude.toFixed(4),
            longitude: position.coords.longitude.toFixed(4),
            accuracy: Math.round(position.coords.accuracy)
          };
        } catch (e) {
          deviceInfo.locationError = e.message || 'è·å–å¤±è´¥';
        }
      } else {
        deviceInfo.locationError = 'ä¸æ”¯æŒ';
      }
      
      return deviceInfo;
    }
    
    function hashCode(str) {
      let hash = 0;
      for (let i = 0; i < str.length; i++) {
        hash = ((hash << 5) - hash) + str.charCodeAt(i);
        hash = hash & hash;
      }
      return Math.abs(hash);
    }

    // ==================== å‡ç­‰éšæœºåˆ†é… ====================
    function getBalancedCondition() {
      const storageKey = `xai_counts_${CONFIG.PLATFORM}_v7`;
      let counts = {};
      try {
        const stored = localStorage.getItem(storageKey);
        if (stored) counts = JSON.parse(stored);
      } catch (e) { counts = {}; }
      
      CONDITIONS.forEach(c => { if (counts[c.key] === undefined) counts[c.key] = 0; });
      const minCount = Math.min(...Object.values(counts));
      const available = CONDITIONS.filter(c => counts[c.key] === minCount);
      const selected = available[Math.floor(Math.random() * available.length)];
      counts[selected.key]++;
      try { localStorage.setItem(storageKey, JSON.stringify(counts)); } catch (e) {}
      return selected;
    }

    // ==================== æ•°æ®æäº¤ ====================
    async function submitData(data) {
      if (CONFIG.DEBUG) console.log('å‡†å¤‡æäº¤æ•°æ®:', data);
      
      if (!CONFIG.DATA_ENDPOINT) {
        console.log('æœªé…ç½®æ•°æ®ç«¯ç‚¹ï¼Œæ•°æ®ä¿å­˜åˆ°æœ¬åœ°');
        saveToLocalStorage(data);
        return { success: true, method: 'localStorage' };
      }
      
      const jsonData = JSON.stringify(data);
      
      // æ–¹æ³•1: ä½¿ç”¨fetch POSTï¼ˆCORSå·²é…ç½®ï¼‰
      try {
        const response = await fetch(CONFIG.DATA_ENDPOINT, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: jsonData
        });
        console.log('fetch POSTæäº¤æˆåŠŸ');
        saveToLocalStorage(data);
        return { success: true, method: 'fetch' };
      } catch (e) {
        console.log('fetch POSTå¤±è´¥:', e);
      }
      
      // æ–¹æ³•2: ä½¿ç”¨GETå‚æ•°æ–¹å¼
      try {
        const encodedData = encodeURIComponent(jsonData);
        const response = await fetch(CONFIG.DATA_ENDPOINT + '?data=' + encodedData, {
          method: 'GET'
        });
        console.log('fetch GETæäº¤æˆåŠŸ');
        saveToLocalStorage(data);
        return { success: true, method: 'fetchGet' };
      } catch (e) {
        console.log('fetch GETå¤±è´¥:', e);
      }
      
      // æ–¹æ³•3: ä½¿ç”¨sendBeacon
      if (navigator.sendBeacon) {
        try {
          const blob = new Blob([jsonData], { type: 'application/json' });
          const submitted = navigator.sendBeacon(CONFIG.DATA_ENDPOINT, blob);
          if (submitted) {
            console.log('sendBeaconæäº¤æˆåŠŸ');
            saveToLocalStorage(data);
            return { success: true, method: 'sendBeacon' };
          }
        } catch (e) {
          console.log('sendBeaconå¤±è´¥:', e);
        }
      }
      
      // æ–¹æ³•4: ä½¿ç”¨Image beaconï¼ˆæœ€å…¼å®¹ï¼‰
      try {
        const encodedData = encodeURIComponent(jsonData);
        const img = new Image();
        img.src = CONFIG.DATA_ENDPOINT + '?data=' + encodedData + '&t=' + Date.now();
        console.log('Image beaconæäº¤');
        saveToLocalStorage(data);
        return { success: true, method: 'image' };
      } catch (e) {
        console.log('Image beaconå¤±è´¥:', e);
      }
      
      saveToLocalStorage(data);
      return { success: false, method: 'localStorage' };
    }
    
    function saveToLocalStorage(data) {
      try {
        localStorage.setItem(`xai_data_${data.participantId}`, JSON.stringify(data));
        let dataList = JSON.parse(localStorage.getItem('xai_data_list') || '[]');
        dataList.push({ id: data.participantId, time: data.startTime });
        localStorage.setItem('xai_data_list', JSON.stringify(dataList));
      } catch (e) {}
    }

    // ==================== å…¨å±€çŠ¶æ€ ====================
    let state = {
      currentPage: 'welcome',
      participantId: 'P' + Date.now().toString(36).toUpperCase() + Math.random().toString(36).substr(2, 4).toUpperCase(),
      startTime: new Date().toISOString(),
      condition: null,
      deviceInfo: null,
      responses: {},
      questionnaireSection: 0,
      submitting: false
    };

    function $(selector) { return document.querySelector(selector); }
    function saveResponse(key, value) { state.responses[key] = value; }
    
    function goToPage(pageName) {
      state.responses[`page_${state.currentPage}_end`] = new Date().toISOString();
      state.currentPage = pageName;
      render();
      window.scrollTo(0, 0);
    }

    function render() {
      const app = $('#app');
      switch(state.currentPage) {
        case 'welcome': app.innerHTML = renderWelcome(); break;
        case 'consent': app.innerHTML = renderConsent(); break;
        case 'scenario': app.innerHTML = renderScenario(); break;
        case 'notification': app.innerHTML = renderNotification(); break;
        case 'questionnaire': app.innerHTML = renderQuestionnaire(); break;
        case 'demographics': app.innerHTML = renderDemographics(); break;
        case 'submitting': app.innerHTML = renderSubmitting(); break;
        case 'complete': app.innerHTML = renderComplete(); break;
      }
    }

    // ==================== é¡µé¢æ¸²æŸ“ ====================
    function renderWelcome() {
      return `
        <div class="page active" style="background: var(--header-gradient); justify-content: center; align-items: center; padding: 40px;">
          <div style="text-align: center;">
            <div style="width: 100px; height: 100px; background: #fff; border-radius: 20px; display: flex; align-items: center; justify-content: center; margin: 0 auto 30px; box-shadow: 0 8px 24px rgba(0,0,0,0.1);">
              <span style="font-size: 50px;">ğŸ›µ</span>
            </div>
            <h1 style="font-size: 28px; font-weight: 700; color: var(--secondary); margin: 0 0 12px;">éª‘æ‰‹ç«¯</h1>
            <p style="font-size: 16px; color: var(--secondary); opacity: 0.8; margin: 0 0 8px;">å¤–å–é…é€å¹³å°</p>
            <div style="background: rgba(0,0,0,0.1); border-radius: 20px; padding: 6px 16px; display: inline-block; margin-top: 10px;">
              <span style="color: var(--secondary); font-size: 13px;">v3.8.2</span>
            </div>
          </div>
          <div style="position: absolute; bottom: 60px; left: 40px; right: 40px;">
            <button class="btn btn-primary" onclick="goToPage('consent')">å¼€å§‹å‚ä¸ç ”ç©¶</button>
            <p style="text-align: center; font-size: 12px; color: var(--secondary); opacity: 0.6; margin-top: 16px;">æœ¬ç ”ç©¶ç”±ä¸­å—è´¢ç»æ”¿æ³•å¤§å­¦å¼€å±•</p>
          </div>
        </div>
      `;
    }

    function renderConsent() {
      return `
        <div class="page active">
          <div class="header"><h2>ç ”ç©¶çŸ¥æƒ…åŒæ„ä¹¦</h2></div>
          <div class="content">
            <div class="card">
              <h3 style="font-size: 16px; color: var(--text); margin: 0 0 15px;">ğŸ“‹ ç ”ç©¶è¯´æ˜</h3>
              <div style="font-size: 14px; color: var(--text-secondary); line-height: 1.8;">
                <p style="margin-bottom: 12px;"><strong>ç ”ç©¶ç›®çš„ï¼š</strong>æœ¬ç ”ç©¶æ—¨åœ¨äº†è§£å¤–å–éª‘æ‰‹çš„æ—¥å¸¸å·¥ä½œä½“éªŒä¸æ„Ÿå—ã€‚</p>
                <p style="margin-bottom: 12px;"><strong>ç ”ç©¶è¿‡ç¨‹ï¼š</strong>æ‚¨å°†é˜…è¯»ä¸€ä¸ªæƒ…æ™¯æè¿°ï¼Œæƒ³è±¡è‡ªå·±æ˜¯æƒ…æ™¯ä¸­çš„å¤–å–éª‘æ‰‹ï¼Œç„¶åå›ç­”ä¸€ç³»åˆ—é—®é¢˜ã€‚æ•´ä¸ªè¿‡ç¨‹çº¦éœ€<strong>5-10åˆ†é’Ÿ</strong>ã€‚</p>
                <p style="margin-bottom: 12px;"><strong>è‡ªæ„¿å‚ä¸ï¼š</strong>æ‚¨çš„å‚ä¸å®Œå…¨è‡ªæ„¿ï¼Œå¯éšæ—¶é€€å‡ºè€Œä¸ä¼šå—åˆ°ä»»ä½•ä¸åˆ©å½±å“ã€‚</p>
                <p style="margin-bottom: 12px;"><strong>éšç§ä¿æŠ¤ï¼š</strong>æ‚¨çš„å›ç­”å°†è¢«åŒ¿åå¤„ç†ï¼Œä»…ç”¨äºå­¦æœ¯ç ”ç©¶ç›®çš„ã€‚</p>
                <p style="margin-bottom: 0;"><strong>è”ç³»æ–¹å¼ï¼š</strong>å¦‚æœ‰ä»»ä½•ç–‘é—®ï¼Œè¯·è”ç³»ç ”ç©¶è´Ÿè´£äººã€‚</p>
              </div>
            </div>
            <div class="option" id="consent-checkbox" onclick="toggleConsent()">
              <div class="option-radio"></div>
              <span class="option-text">æˆ‘å·²é˜…è¯»å¹¶ç†è§£ä¸Šè¿°å†…å®¹ï¼ŒåŒæ„å‚ä¸æœ¬ç ”ç©¶</span>
            </div>
          </div>
          <div class="footer">
            <button class="btn btn-primary" id="consent-btn" disabled onclick="startExperiment()">æˆ‘åŒæ„å‚ä¸</button>
          </div>
        </div>
      `;
    }
    
    function toggleConsent() {
      const cb = $('#consent-checkbox');
      cb.classList.toggle('selected');
      $('#consent-btn').disabled = !cb.classList.contains('selected');
    }
    
    function startExperiment() {
      state.condition = getBalancedCondition();
      saveResponse('condition_key', state.condition.key);
      saveResponse('explanation_type', state.condition.explanation);
      saveResponse('context_awareness', state.condition.contextAwareness);
      saveResponse('platform', CONFIG.PLATFORM);
      goToPage('scenario');
    }

    function renderScenario() {
      return `
        <div class="page active">
          <div class="header">
            <h2>ğŸ“– æƒ…æ™¯ä»‹ç»</h2>
            <p>è¯·ä»”ç»†é˜…è¯»å¹¶ä»£å…¥è§’è‰²</p>
          </div>
          <div class="content">
            <div class="card" style="background: linear-gradient(135deg, #FFFDE7 0%, #FFF 100%); border: 1px solid #FFE082;">
              <div style="display: flex; align-items: center; margin-bottom: 12px;">
                <span style="font-size: 24px; margin-right: 10px;">ğŸ›µ</span>
                <span style="font-size: 16px; font-weight: 600; color: #F57C00;">æ‚¨çš„è§’è‰²è®¾å®š</span>
              </div>
              <p style="font-size: 14px; color: #5D4037; line-height: 1.8; margin: 0;">
                æ‚¨æ˜¯ä¸€ååœ¨æŸå¤–å–å¹³å°æ¥å•çš„éª‘æ‰‹ã€‚
              </p>
            </div>
            
            <div class="card">
              <h4 style="font-size: 15px; color: var(--text); margin: 0 0 12px;">â­ éª‘æ‰‹æ˜Ÿçº§åˆ¶åº¦</h4>
              <div style="font-size: 13px; color: var(--text-secondary); line-height: 1.8;">
                <p style="margin: 0 0 8px;">â€¢ æ‚¨çš„åŸºç¡€é…é€è´¹ä¸å—æ˜Ÿçº§å½±å“</p>
                <p style="margin: 0 0 8px;">â€¢ <strong style="color: #F57C00;">å…­æ˜Ÿçº§éª‘æ‰‹</strong>æ¯å•å¯è·å¾—é¢å¤– <strong style="color: var(--danger);">0.55å…ƒ</strong> çš„å†²å•è¡¥è´´</p>
                <div style="background: var(--primary-light); padding: 8px 12px; border-radius: 6px; margin-top: 12px;">
                  <strong>æ‚¨ç›®å‰çš„æ´¾å•ä¼˜å…ˆçº§æ˜¯ã€Œå…­æ˜Ÿçº§ã€</strong>
                </div>
              </div>
            </div>
            
            <div class="card">
              <h4 style="font-size: 15px; color: var(--text); margin: 0 0 12px;">ğŸ“ ç”³è¯‰é€šé“è¯´æ˜</h4>
              <div style="font-size: 13px; color: var(--text-secondary); line-height: 1.8;">
                <p style="margin: 0 0 8px;">â€¢ ç”³è¯‰è¿‡ç¨‹ä¿å¯†ï¼Œä¸ä¼šå½±å“æ­£å¸¸æ¥å•å’Œè´¦å·çŠ¶æ€</p>
                <p style="margin: 0 0 8px;">â€¢ æ¯æ¡ç”³è¯‰ç”±ä¸“äººå¤æ ¸ï¼Œ48hå†…å›å¤åé¦ˆç»“æœ</p>
                <p style="margin: 0;">â€¢ å¦‚ç”³è¯‰æˆç«‹ï¼Œå°†æ’¤é”€è°ƒæ•´å¹¶æ¢å¤åŸæœ‰æ˜Ÿçº§</p>
              </div>
            </div>
            
            <div class="card" style="background: linear-gradient(135deg, #FFEBEE 0%, #FFF 100%); border: 1px solid #FFCDD2;">
              <div style="display: flex; align-items: center; margin-bottom: 10px;">
                <span style="font-size: 20px; margin-right: 8px;">ğŸ˜Ÿ</span>
                <span style="font-size: 15px; font-weight: 600; color: #C62828;">è¿‘æœŸå˜åŒ–</span>
              </div>
              <p style="font-size: 14px; color: #5D4037; line-height: 1.8; margin: 0;">
                æœ€è¿‘å‡ å¤©ï¼Œæ‚¨æ˜æ˜¾æ„Ÿè§‰åˆ°æ‰‹çš„ç»“ç®—æ”¶å…¥å˜å°‘äº†ï¼Œè€Œä¸”åŒæ ·çš„å•å­é…é€è´¹ä¼¼ä¹æ¯”ä»¥å‰æ›´ä½äº†ã€‚
              </p>
            </div>
          </div>
          <div class="footer">
            <button class="btn btn-yellow" onclick="goToPage('notification')">æ‰“å¼€APPæŸ¥çœ‹é€šçŸ¥ â†’</button>
          </div>
        </div>
      `;
    }

    function renderNotification() {
      const isHighContext = state.condition.contextAwareness === 'high';
      const explanationType = state.condition.explanation;
      
      let contextHTML = isHighContext ? `
        <div class="explanation-box explanation-context">
          <p style="font-size: 14px; color: #2E7D32; margin: 0 0 12px; font-weight: 500;">åŒæ—¶ï¼Œç³»ç»Ÿå·²é€å•åˆ†æäº†æ‚¨é…é€æ—¶é‡åˆ°çš„å®é™…æƒ…å†µï¼š</p>
          <div style="font-size: 13px; color: #33691E; line-height: 1.8;">
            <p style="margin: 0 0 6px;">Â· 12æœˆ3æ—¥ è®¢å•#2847ï¼šå½“æ—¥æš´é›¨ï¼Œè·¯é¢ç§¯æ°´ä¸¥é‡ï¼Œ<span style="color: #00C853; font-weight: 500;">å·²çº³å…¥è€ƒè™‘</span></p>
            <p style="margin: 0 0 6px;">Â· 12æœˆ11æ—¥ è®¢å•#3156ï¼šå•†å®¶å‡ºé¤å»¶è¿Ÿ23åˆ†é’Ÿï¼Œ<span style="color: #00C853; font-weight: 500;">å·²çº³å…¥è€ƒè™‘</span></p>
            <p style="margin: 0 0 6px;">Â· 12æœˆ18æ—¥ è®¢å•#3892ï¼šæ™šé«˜å³°äº¤é€šæ‹¥å µï¼Œ<span style="color: #00C853; font-weight: 500;">å·²çº³å…¥è€ƒè™‘</span></p>
            <p style="margin: 0; font-style: italic;">â€¦â€¦å…±è®¡47å•å­˜åœ¨å®¢è§‚å›°éš¾å› ç´ ï¼Œå‡å·²çº³å…¥è¯„ä¼°</p>
          </div>
        </div>
      ` : `
        <div style="background: #F5F5F5; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
          <p style="font-size: 14px; color: #666; margin: 0;">æ‰€æœ‰éª‘æ‰‹é€‚ç”¨ç›¸åŒè€ƒæ ¸è§„åˆ™ã€‚</p>
        </div>
      `;
      
      let explanationHTML = '';
      if (explanationType === 'feature') {
        explanationHTML = `
          <div class="explanation-box explanation-feature">
            <h4 style="font-size: 14px; color: #1565C0; margin: 0 0 12px;">ğŸ“Š æœ¬æ¬¡è°ƒæ•´çš„ä¸»è¦ä¾æ®</h4>
            <p style="font-size: 13px; color: #1976D2; margin: 0 0 12px;">ç³»ç»Ÿåˆ†ææ˜¾ç¤ºï¼Œä»¥ä¸‹æŒ‡æ ‡å½±å“äº†æ‚¨çš„æ´¾å•ä¼˜å…ˆçº§ï¼š</p>
            <div style="background: #fff; border-radius: 6px; padding: 12px; margin-bottom: 10px;">
              <p style="font-size: 13px; font-weight: 500; color: var(--text); margin: 0 0 6px;">â–¸ å‡†æ—¶é€è¾¾ç‡ï¼š82.3%ï¼ˆå¹³å°è¦æ±‚â‰¥88%ï¼‰</p>
              <div style="display: flex; align-items: center;"><span style="font-size: 12px; color: var(--text-secondary); margin-right: 8px;">å½±å“æƒé‡ï¼š</span><span class="weight-stars">â˜…â˜…â˜…â˜…â˜…</span></div>
            </div>
            <div style="background: #fff; border-radius: 6px; padding: 12px; margin-bottom: 10px;">
              <p style="font-size: 13px; font-weight: 500; color: var(--text); margin: 0 0 6px;">â–¸ é¡¾å®¢è¯„åˆ†ï¼š4.2åˆ†ï¼ˆå¹³å°è¦æ±‚â‰¥4.5åˆ†ï¼‰</p>
              <div style="display: flex; align-items: center;"><span style="font-size: 12px; color: var(--text-secondary); margin-right: 8px;">å½±å“æƒé‡ï¼š</span><span class="weight-stars">â˜…â˜…â˜…â˜…â˜†</span></div>
            </div>
            <div style="background: #fff; border-radius: 6px; padding: 12px;">
              <p style="font-size: 13px; font-weight: 500; color: var(--text); margin: 0 0 6px;">â–¸ è®¢å•å–æ¶ˆç‡ï¼š4.8%ï¼ˆå¹³å°è¦æ±‚â‰¤3%ï¼‰</p>
              <div style="display: flex; align-items: center;"><span style="font-size: 12px; color: var(--text-secondary); margin-right: 8px;">å½±å“æƒé‡ï¼š</span><span class="weight-stars">â˜…â˜…â˜…â˜†â˜†</span></div>
            </div>
          </div>
        `;
      } else if (explanationType === 'counterfactual') {
        explanationHTML = `
          <div class="explanation-box explanation-counterfactual">
            <h4 style="font-size: 14px; color: #7B1FA2; margin: 0 0 12px;">ğŸ¯ å¦‚ä½•æ¢å¤ã€Œå…­æ˜Ÿçº§ã€</h4>
            <p style="font-size: 13px; color: #8E24AA; margin: 0 0 12px;">ç³»ç»Ÿåˆ†ææ˜¾ç¤ºï¼Œå¦‚æœæ‚¨åšåˆ°ä»¥ä¸‹æ”¹è¿›ï¼Œå¯ä»¥æ¢å¤ã€Œå…­æ˜Ÿçº§ã€ï¼š</p>
            <div style="background: #fff; border-radius: 6px; padding: 12px; margin-bottom: 10px;">
              <p style="font-size: 13px; color: var(--text); margin: 0 0 6px;">â–¸ å¦‚æœæ‚¨çš„å‡†æ—¶é€è¾¾ç‡ä» <strong>82.3%</strong> æå‡åˆ° <strong style="color: #7B1FA2;">88%ä»¥ä¸Š</strong></p>
              <p style="font-size: 12px; color: #00C853; margin: 0;">â†’ æ‚¨å°†è¾¾åˆ°å…­æ˜Ÿçº§è¡¥è´´çš„æ—¶æ•ˆè¦æ±‚ âœ“</p>
            </div>
            <div style="background: #fff; border-radius: 6px; padding: 12px; margin-bottom: 10px;">
              <p style="font-size: 13px; color: var(--text); margin: 0 0 6px;">â–¸ å¦‚æœæ‚¨çš„é¡¾å®¢è¯„åˆ†ä» <strong>4.2åˆ†</strong> æå‡åˆ° <strong style="color: #7B1FA2;">4.5åˆ†ä»¥ä¸Š</strong></p>
              <p style="font-size: 12px; color: #00C853; margin: 0;">â†’ æ‚¨å°†è¾¾åˆ°å…­æ˜Ÿçº§è¡¥è´´çš„æœåŠ¡è¦æ±‚ âœ“</p>
            </div>
            <div style="background: #fff; border-radius: 6px; padding: 12px;">
              <p style="font-size: 13px; color: var(--text); margin: 0 0 6px;">â–¸ å¦‚æœæ‚¨çš„è®¢å•å–æ¶ˆç‡ä» <strong>4.8%</strong> é™ä½åˆ° <strong style="color: #7B1FA2;">3%ä»¥ä¸‹</strong></p>
              <p style="font-size: 12px; color: #00C853; margin: 0;">â†’ æ‚¨å°†è¾¾åˆ°å…­æ˜Ÿçº§è¡¥è´´çš„ç¨³å®šæ€§è¦æ±‚ âœ“</p>
            </div>
            <div style="background: #F3E5F5; border-radius: 6px; padding: 10px; margin-top: 12px;">
              <p style="font-size: 12px; color: #7B1FA2; margin: 0; font-weight: 500;">ğŸ’¡ è¾¾æˆä»¥ä¸Šä»»æ„ä¸¤é¡¹ï¼Œç³»ç»Ÿå°†åœ¨ä¸‹æ¬¡è¯„ä¼°æ—¶æ¢å¤æ‚¨çš„å…­æ˜Ÿçº§èº«ä»½ã€‚</p>
            </div>
          </div>
        `;
      }
      
      return `
        <div class="page active">
          <div style="display: flex; align-items: center; padding: 50px 16px 16px; background: var(--header-gradient); color: var(--secondary);">
            <span style="font-size: 20px; margin-right: 12px;">â†</span>
            <span style="font-size: 17px; font-weight: 600;">ç³»ç»Ÿé€šçŸ¥</span>
          </div>
          <div class="content">
            <div class="card" style="padding: 0; overflow: hidden;">
              <div class="notification-header">
                <span style="font-size: 40px; display: block; margin-bottom: 10px;">ğŸ“¢</span>
                <h3 style="margin: 0; font-size: 18px; font-weight: 600;">ç³»ç»Ÿé€šçŸ¥</h3>
                <p style="margin: 8px 0 0; font-size: 13px; opacity: 0.8;">æœ¬æ¬¡è¯„ä¼°ç”±å¹³å°æ™ºèƒ½è°ƒåº¦ç³»ç»Ÿå®Œæˆ</p>
              </div>
              <div class="notification-body">
                <div class="data-card">
                  <p style="font-size: 14px; color: var(--text); margin: 0 0 12px;">ç³»ç»Ÿä¾æ®å¹³å°æ ‡å‡†ï¼Œæ ¹æ®æ‚¨è¿‘30å¤©çš„é…é€æ•°æ®è¿›è¡Œè¯„ä¼°ï¼š</p>
                  <div class="data-item"><span style="font-size: 13px; color: var(--text-secondary);">â±ï¸ å‡†æ—¶é€è¾¾ç‡</span><span style="font-size: 15px; font-weight: 600; color: var(--text);">82.3%</span></div>
                  <div class="data-item"><span style="font-size: 13px; color: var(--text-secondary);">â­ é¡¾å®¢å¹³å‡è¯„åˆ†</span><span style="font-size: 15px; font-weight: 600; color: var(--text);">4.2åˆ†</span></div>
                  <div class="data-item"><span style="font-size: 13px; color: var(--text-secondary);">âŒ è®¢å•å–æ¶ˆç‡</span><span style="font-size: 15px; font-weight: 600; color: var(--text);">4.8%</span></div>
                </div>
                ${contextHTML}
                <div class="result-box">
                  <p style="font-size: 14px; color: var(--text-secondary); margin: 0 0 12px;">åŸºäº${isHighContext ? 'å¯¹æ‚¨å®é™…é…é€æƒ…å¢ƒçš„ç»¼åˆåˆ†æ' : 'ç»Ÿä¸€æ ‡å‡†è¯„ä¼°'}ï¼Œç³»ç»Ÿå¯¹æ‚¨çš„æ´¾å•ä¼˜å…ˆçº§åšå‡ºä»¥ä¸‹è°ƒæ•´ï¼š</p>
                  <div class="star-change">
                    <div style="text-align: center;"><div style="font-size: 13px; color: var(--text-secondary);">åŸæ˜Ÿçº§</div><div class="star-old">å…­æ˜Ÿçº§</div></div>
                    <span style="font-size: 30px;">â†’</span>
                    <div style="text-align: center;"><div style="font-size: 13px; color: var(--text-secondary);">æ–°æ˜Ÿçº§</div><div class="star-new">äº”æ˜Ÿçº§</div></div>
                  </div>
                  <div style="background: #FFEBEE; border-radius: 6px; padding: 12px; text-align: left;">
                    <p style="font-size: 13px; color: #C62828; margin: 0 0 6px; font-weight: 500;">è°ƒæ•´åå½±å“ï¼š</p>
                    <p style="font-size: 13px; color: #C62828; margin: 0 0 4px;">â€¢ æ¯å•é¢å¤–è¡¥è´´å°†å‡å°‘ 0.2å…ƒï¼ˆä»0.55å…ƒé™è‡³0.35å…ƒï¼‰</p>
                    <p style="font-size: 13px; color: #C62828; margin: 0;">â€¢ åŸºç¡€é…é€è´¹ä¸å˜ï¼Œä½†é¢„è®¡æ¯æ—¥æ€»æ”¶å…¥å°†ä¸‹é™</p>
                  </div>
                </div>
                ${explanationHTML}
                <div class="tip-box">
                  <p style="font-size: 14px; color: var(--text); margin: 0 0 8px;">å¦‚æ‚¨è®¤ä¸ºæœ¬æ¬¡è°ƒæ•´ä¸åˆç†ï¼Œå¯åœ¨<strong>7æ—¥å†…</strong>é€šè¿‡APPæäº¤ç”³è¯‰ã€‚</p>
                  <p style="font-size: 13px; color: var(--success); margin: 0;">âœ“ ç”³è¯‰ä¸ä¼šå¯¹æ‚¨çš„è´¦å·å’Œæ´¾å•äº§ç”Ÿä»»ä½•è´Ÿé¢å½±å“ã€‚</p>
                </div>
              </div>
            </div>
          </div>
          <div class="footer">
            <button class="btn btn-primary" onclick="goToPage('questionnaire')">æˆ‘å·²äº†è§£ï¼Œç»§ç»­å¡«å†™é—®å·</button>
          </div>
        </div>
      `;
    }

    // ==================== é—®å·é¢˜é¡¹é…ç½®ï¼ˆä¿®æ­£ç‰ˆï¼‰====================
    const QUESTIONNAIRE_SECTIONS = [
      // ç¬¬1éƒ¨åˆ†ï¼šè°ƒèŠ‚å˜é‡ï¼ˆå¹³å°ç»æµä¾èµ–ï¼‰
      {
        title: 'æ‚¨çš„å·¥ä½œæƒ…å†µ',
        description: 'ä»¥ä¸‹é—®é¢˜å¸®åŠ©æˆ‘ä»¬äº†è§£æ‚¨çš„å®é™…å·¥ä½œçŠ¶æ€',
        questions: [
          { 
            id: 'income_ratio', 
            type: 'single', 
            text: 'è¯¥å¹³å°çš„æ”¶å…¥å¤§çº¦å æ‚¨ä¸ªäººæœˆæ€»æ”¶å…¥çš„å¤šå°‘ï¼Ÿ',
            options: ['25%ä»¥ä¸‹', '25%-50%', '51%-75%', '75%ä»¥ä¸Š']
          },
          { 
            id: 'platform_mode', 
            type: 'single', 
            text: 'æ‚¨ç›®å‰çš„è·‘å•æ¨¡å¼å±äºä»¥ä¸‹å“ªç§æƒ…å†µï¼Ÿ',
            options: [
              'ä»…åœ¨è¯¥å¹³å°ä¸€ä¸ªå¹³å°è·‘å•',
              'ä»¥è¯¥å¹³å°ä¸ºä¸»ï¼Œå¶å°”åœ¨å…¶ä»–å¹³å°è·‘å•',
              'åŒæ—¶åœ¨å¤šä¸ªå¹³å°æ¥å•ï¼Œæ²¡æœ‰å›ºå®šçš„ä¸»æ¬¡ä¹‹åˆ†',
              'ä»¥å…¶ä»–å¹³å°ä¸ºä¸»ï¼Œè¯¥å¹³å°åªæ˜¯å…¼èŒè¡¥å……'
            ]
          },
          { 
            id: 'career_plan', 
            type: 'single', 
            text: 'å…³äºæœªæ¥ä¸‰å¹´ï¼Œæ‚¨å¦‚ä½•çœ‹å¾…å¤–å–éª‘æ‰‹è¿™ä»½å·¥ä½œï¼Ÿ',
            options: [
              'è¿‡æ¸¡æ€§å·¥ä½œï¼šç›®å‰åªæ˜¯æš‚æ—¶åšéª‘æ‰‹ï¼Œè®¡åˆ’åœ¨3å¹´å†…è½¬è¡Œåšå…¶ä»–å·¥ä½œ',
              'é•¿æœŸèŒä¸šï¼šè®¡åˆ’åœ¨æœªæ¥3å¹´å†…ç»§ç»­ä»äº‹å¤–å–é…é€å·¥ä½œï¼Œå¹¶ä»¥æ­¤ä¸ºç”Ÿ',
              'ä¸ç¡®å®šï¼šè¿˜æ²¡æœ‰æ˜ç¡®çš„è®¡åˆ’ï¼Œçœ‹æƒ…å†µè€Œå®š'
            ]
          }
        ]
      },
      // ç¬¬2éƒ¨åˆ†ï¼šä¸­ä»‹-è‡ªæˆ‘ä»·å€¼å¨èƒ
      {
        title: 'æ‚¨çš„æ„Ÿå—',
        description: 'è¯·æ ¹æ®çœ‹åˆ°è¯„ä¼°ç»“æœåçš„æ„Ÿå—å›ç­”ï¼ˆ1=å®Œå…¨ä¸åŒæ„ï¼Œ5=å®Œå…¨åŒæ„ï¼‰',
        questions: [
          { id: 'self_worth_1', type: 'likert', text: 'çœ‹åˆ°è¿™ä¸ªè¯„ä¼°ç»“æœåï¼Œæˆ‘å¯¹è‡ªå·±é€å¥½å¤–å–çš„èƒ½åŠ›æ²¡ä»€ä¹ˆä¿¡å¿ƒäº†ã€‚' },
          { id: 'self_worth_2', type: 'likert', text: 'çœ‹åˆ°è¿™ä¸ªè¯„ä¼°ç»“æœåï¼Œæˆ‘æ„Ÿåˆ°æŒ«è´¥ã€‚' },
          { id: 'self_worth_3', type: 'likert', text: 'çœ‹åˆ°è¿™ä¸ªè¯„ä¼°ç»“æœåï¼Œæˆ‘è§‰å¾—è‡ªå·±ä½œä¸ºéª‘æ‰‹ä¸å¤Ÿå¥½ã€‚' }
        ]
      },
      // ç¬¬3éƒ¨åˆ†ï¼šä¸­ä»‹-è‡ªæˆ‘æå‡æœºä¼šæ„ŸçŸ¥
      {
        title: 'å¯¹åé¦ˆçš„çœ‹æ³•',
        description: 'è¯·æ ¹æ®æ‚¨çš„æ„Ÿå—å›ç­”ï¼ˆ1=å®Œå…¨ä¸åŒæ„ï¼Œ5=å®Œå…¨åŒæ„ï¼‰',
        questions: [
          { id: 'improve_1', type: 'likert', text: 'è¿™ä¸ªè§£é‡Šè®©æˆ‘æ˜ç™½äº†ä»¥åé€å•æ€ä¹ˆèƒ½åšå¾—æ›´å¥½ã€‚' },
          { id: 'improve_2', type: 'likert', text: 'æˆ‘å¯ä»¥ä½¿ç”¨è¿™äº›ä¿¡æ¯æ¥æå‡æˆ‘çš„è·‘å•æ°´å¹³ã€‚' },
          { id: 'improve_3', type: 'likert', text: 'è¿™ä¸ªåé¦ˆå¯¹æˆ‘æœªæ¥çš„å·¥ä½œæ”¹è¿›æœ‰ä»·å€¼ã€‚' }
        ]
      },
      // ç¬¬4éƒ¨åˆ†ï¼šä¸­ä»‹-æœªæ¥è‡ªæˆ‘è¿ç»­æ€§
      {
        title: 'å¯¹æœªæ¥çš„çœ‹æ³•',
        description: 'è¯·æ€è€ƒæ‚¨ç°åœ¨çš„è‡ªå·±ä¸ç»§ç»­åœ¨è¯¥å¹³å°å·¥ä½œåçš„è‡ªå·±',
        questions: [
          { id: 'future_self_visual', type: 'overlap', text: 'è¯·é€‰æ‹©ä¸€ç»„åœ†åœˆï¼Œæœ€èƒ½ä»£è¡¨æ‚¨ç°åœ¨çš„è‡ªå·±ä¸ç»§ç»­åœ¨è¯¥å¹³å°å·¥ä½œä¸€æ®µæ—¶é—´åçš„è‡ªå·±ï¼ˆæœªæ¥çš„è‡ªå·±ï¼‰çš„é‡å ç¨‹åº¦ã€‚' },
          { id: 'future_self_1', type: 'likert', text: 'æˆ‘æ„Ÿåˆ°ç°åœ¨çš„è‡ªå·±å’Œç»§ç»­åšè¿™ä»½å·¥ä½œåçš„è‡ªå·±æœ‰å¾ˆå¼ºçš„è”ç³»ã€‚' }
        ]
      },
      // ç¬¬5éƒ¨åˆ†ï¼šä¸­ä»‹-æ§åˆ¶æ„Ÿæ¢å¤ï¼ˆä¿®æ­£ï¼‰
      {
        title: 'å…³äºè¿™ä»¶äº‹',
        description: 'è¯·æ ¹æ®æ‚¨å¯¹è¿™ä»¶äº‹çš„æ„Ÿå—å›ç­”ï¼ˆ1=å®Œå…¨ä¸åŒæ„ï¼Œ5=å®Œå…¨åŒæ„ï¼‰',
        questions: [
          { id: 'control_1', type: 'likert', text: 'æˆ‘è§‰å¾—æˆ‘æœ‰èƒ½åŠ›å½±å“è¿™ä»¶äº‹æƒ…çš„æœ€ç»ˆå¤„ç†ç»“æœã€‚' },
          { id: 'control_2', type: 'likert', text: 'å¯¹äºèƒ½ä¸èƒ½æ‹¿å›"å…­æ˜Ÿçº§"èº«ä»½ï¼Œæˆ‘è§‰å¾—æˆ‘æœ‰æŠŠæ¡ã€‚' },
          { id: 'control_3', type: 'likert', text: 'æˆ‘æ¸…æ¥šè‡ªå·±èƒ½åšäº›ä»€ä¹ˆæ¥æ¢å¤å…­æ˜Ÿçº§èº«ä»½ã€‚' }
        ]
      },
      // ç¬¬6éƒ¨åˆ†ï¼šä¸­ä»‹-è´£å¤‡ç›®æ ‡æ˜ç¡®æ€§ï¼ˆä¿®æ­£ï¼‰
      {
        title: 'å…³äºè¿™æ¬¡ç»“æœ',
        description: 'è¯·æ ¹æ®æ‚¨çš„æ„Ÿå—å›ç­”ï¼ˆ1=å®Œå…¨ä¸åŒæ„ï¼Œ5=å®Œå…¨åŒæ„ï¼‰',
        questions: [
          { id: 'blame_1', type: 'likert', text: 'æˆ‘å¾ˆæ¸…æ¥šåˆ°åº•æ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´æˆ‘çš„æ˜Ÿçº§è¢«ä¸‹è°ƒã€‚' },
          { id: 'blame_2', type: 'likert', text: 'æˆ‘èƒ½ç¡®åˆ‡åœ°æŒ‡å‡ºè°åº”è¯¥ä¸ºè¿™ä¸ªç»“æœè´Ÿè´£ã€‚' },
          { id: 'blame_3', type: 'likert', text: 'å¯¹äºè¿™ä¸€ç»“æœï¼Œæˆ‘å¾ˆéš¾åˆ¤æ–­è´£ä»»ç©¶ç«Ÿåœ¨äºç³»ç»Ÿç®—æ³•ã€å…¬å¸è§„å®šè¿˜æ˜¯æˆ‘ä¸ªäººã€‚' }
        ]
      },
      // ç¬¬7éƒ¨åˆ†ï¼šä¸­ä»‹-æ„ŸçŸ¥ç»„ç»‡æ¸©åº¦
      {
        title: 'å¯¹å¹³å°çš„å°è±¡',
        description: 'è¯·æ ¹æ®æ‚¨çš„æ„Ÿå—å›ç­”ï¼ˆ1=å®Œå…¨ä¸åŒæ„ï¼Œ5=å®Œå…¨åŒæ„ï¼‰',
        questions: [
          { id: 'warmth_1', type: 'likert', text: 'æˆ‘è§‰å¾—è¿™å®¶å…¬å¸æ˜¯å‹å¥½çš„ã€‚' },
          { id: 'warmth_2', type: 'likert', text: 'æˆ‘è§‰å¾—è¿™å®¶å…¬å¸æ˜¯çƒ­æƒ…çš„ã€‚' },
          { id: 'warmth_3', type: 'likert', text: 'æˆ‘è§‰å¾—è¿™å®¶å…¬å¸æ˜¯çœŸè¯šçš„ã€‚' },
          { id: 'warmth_4', type: 'likert', text: 'æˆ‘è§‰å¾—è¿™å®¶å…¬å¸æ˜¯å€¼å¾—ä¿¡èµ–çš„ã€‚' }
        ]
      },
      // ç¬¬8éƒ¨åˆ†ï¼šå› å˜é‡-ç”³è¯‰æ„å›¾
      {
        title: 'æ‚¨çš„æ‰“ç®—',
        description: 'è¯·æ ¹æ®æ‚¨çš„æ„æ„¿å›ç­”ï¼ˆ1=å®Œå…¨ä¸åŒæ„ï¼Œ5=å®Œå…¨åŒæ„ï¼‰',
        questions: [
          { id: 'appeal_1', type: 'likert', text: 'æˆ‘æ‰“ç®—å¯¹è¿™æ¬¡æ˜Ÿçº§è°ƒæ•´æå‡ºç”³è¯‰ã€‚' },
          { id: 'appeal_2', type: 'likert', text: 'æˆ‘ä¼šè¦æ±‚å¹³å°äººå·¥é‡æ–°å®¡æ ¸è¿™æ¬¡è¯„ä¼°ç»“æœã€‚' },
          { id: 'appeal_3', type: 'likert', text: 'æˆ‘å¾ˆæœ‰å¯èƒ½é€šè¿‡APPå¯¹è¯¥ç»“æœæå‡ºæ­£å¼å¼‚è®®ã€‚' }
        ]
      },
      // ç¬¬9éƒ¨åˆ†ï¼šå› å˜é‡-AIåé¦ˆæ¥å—åº¦
      {
        title: 'å¯¹å¹³å°è¯„ä¼°çš„çœ‹æ³•',
        description: 'è¯·æ ¹æ®æ‚¨çš„çœ‹æ³•å›ç­”ï¼ˆ1=å®Œå…¨ä¸åŒæ„ï¼Œ5=å®Œå…¨åŒæ„ï¼‰',
        questions: [
          { id: 'ai_accept_1', type: 'likert', text: 'å¹³å°ç®—æ³•å¯¹éª‘æ‰‹è¿›è¡Œè¿™æ ·çš„ç»©æ•ˆè¯„ä¼°æ˜¯åˆé€‚çš„ã€‚' },
          { id: 'ai_accept_2', type: 'likert', text: 'å¹³å°åº”è¯¥ç”±ç®—æ³•æ¥åšå‡ºè¿™ç±»æ˜Ÿçº§è°ƒæ•´çš„å†³å®šã€‚' },
          { id: 'ai_accept_3', type: 'likert', text: 'å¹³å°ç®—æ³•ä¸åº”è¯¥è¢«å…è®¸åšå‡ºè¿™æ ·çš„è¯„ä¼°å†³å®šã€‚' }
        ]
      },
      // ç¬¬10éƒ¨åˆ†ï¼šæ³¨æ„åŠ›æ£€éªŒï¼ˆå¸¸è¯†ç¡®è®¤ï¼‰
      {
        title: 'å¸¸è¯†ç¡®è®¤',
        description: 'è¯·å›ç­”ä»¥ä¸‹é—®é¢˜',
        questions: [
          { 
            id: 'attention_check', 
            type: 'likert', 
            text: 'ä¸ºç¡®ä¿æ‚¨è®¤çœŸé˜…è¯»äº†é¢˜ç›®ï¼Œè¯·é€‰æ‹©"æ¯”è¾ƒåŒæ„"ï¼ˆæ•°å­—4ï¼‰è¿™ä¸ªé€‰é¡¹ã€‚'
          }
        ]
      },
      // ç¬¬11éƒ¨åˆ†ï¼šæ“çºµæ£€éªŒï¼ˆå›å¿†ç¡®è®¤ï¼‰- ç§»åˆ°è¿™é‡Œ
      {
        title: 'å›å¿†ç¡®è®¤',
        description: 'è¯·æ ¹æ®æ‚¨ä¹‹å‰çœ‹åˆ°çš„ç³»ç»Ÿé€šçŸ¥å†…å®¹å›ç­”',
        questions: [
          { 
            id: 'manipulation_check_explanation', 
            type: 'single', 
            text: 'åœ¨ä¹‹å‰çš„ç³»ç»Ÿé€šçŸ¥ä¸­ï¼Œå…³äºæ‚¨æ˜Ÿçº§è°ƒæ•´çš„åŸå› ï¼Œå¹³å°æä¾›äº†å“ªç§ç±»å‹çš„è¯´æ˜ï¼Ÿ',
            options: [
              'åªå‘Šè¯‰äº†æˆ‘è°ƒæ•´ç»“æœï¼Œæ²¡æœ‰æä¾›å…·ä½“åŸå› çš„è§£é‡Š',
              'å‘Šè¯‰äº†æˆ‘å“ªäº›æŒ‡æ ‡å½±å“äº†æˆ‘çš„æ˜Ÿçº§ï¼Œä»¥åŠå„é¡¹æŒ‡æ ‡çš„å½±å“æƒé‡',
              'å‘Šè¯‰äº†æˆ‘å¦‚æœæ”¹è¿›å“ªäº›æ–¹é¢ï¼Œå¯ä»¥æ¢å¤å…­æ˜Ÿçº§'
            ]
          },
          { 
            id: 'manipulation_check_context', 
            type: 'single', 
            text: 'åœ¨ä¹‹å‰çš„ç³»ç»Ÿé€šçŸ¥ä¸­ï¼Œå¹³å°æ˜¯å¦æåˆ°è€ƒè™‘äº†æ‚¨é…é€æ—¶é‡åˆ°çš„å®é™…å›°éš¾ï¼ˆå¦‚å¤©æ°”ã€å•†å®¶å‡ºé¤æ…¢ç­‰ï¼‰ï¼Ÿ',
            options: [
              'æ˜¯çš„ï¼Œç³»ç»Ÿæåˆ°å·²ç»é€å•åˆ†æå¹¶è€ƒè™‘äº†æˆ‘é‡åˆ°çš„å…·ä½“å›°éš¾æƒ…å†µ',
              'æ²¡æœ‰ï¼Œç³»ç»Ÿåªè¯´æ‰€æœ‰éª‘æ‰‹é€‚ç”¨ç›¸åŒçš„è€ƒæ ¸è§„åˆ™'
            ]
          }
        ]
      }
    ];

    // ==================== é—®å·æ¸²æŸ“ ====================
    function renderQuestionnaire() {
      const section = QUESTIONNAIRE_SECTIONS[state.questionnaireSection];
      const progress = ((state.questionnaireSection + 1) / QUESTIONNAIRE_SECTIONS.length) * 100;
      
      let questionsHTML = '';
      section.questions.forEach((q, idx) => {
        let inputHTML = '';
        
        if (q.type === 'single') {
          inputHTML = q.options.map((opt, optIdx) => `
            <div class="option ${state.responses[q.id] === opt ? 'selected' : ''}" onclick="handleOptionSelect('${q.id}', ${optIdx})">
              <div class="option-radio"></div>
              <span class="option-text">${opt}</span>
            </div>
          `).join('');
        } else if (q.type === 'likert') {
          inputHTML = `
            <div class="likert-scale">
              ${[1,2,3,4,5].map(val => `
                <div class="likert-item ${state.responses[q.id] === val ? 'selected' : ''}" onclick="selectLikert('${q.id}', ${val})">
                  <div class="likert-circle">${val}</div>
                  <div class="likert-label">${val === 1 ? 'å®Œå…¨ä¸åŒæ„' : val === 5 ? 'å®Œå…¨åŒæ„' : ''}</div>
                </div>
              `).join('')}
            </div>
          `;
        } else if (q.type === 'overlap') {
          const overlapLabels = ['å®Œå…¨åˆ†ç¦»', '', '', 'éƒ¨åˆ†é‡å ', '', '', 'å®Œå…¨é‡å '];
          inputHTML = `
            <div style="display: flex; flex-direction: column; gap: 8px;">
              ${[1,2,3,4,5,6,7].map(val => {
                const overlap = (val - 1) * -4.5;
                return `
                  <div class="overlap-option ${state.responses[q.id] === val ? 'selected' : ''}" onclick="selectLikert('${q.id}', ${val})">
                    <div class="overlap-circles">
                      <div class="circle-self"></div>
                      <div class="circle-future" style="margin-left: ${overlap}px;"></div>
                    </div>
                    <span style="font-size: 12px; color: var(--text-secondary); min-width: 60px; text-align: right;">${overlapLabels[val-1]}</span>
                  </div>
                `;
              }).join('')}
            </div>
            <div style="display: flex; justify-content: space-between; margin-top: 8px; padding: 0 4px;">
              <span style="font-size: 11px; color: #999;">ğŸŸ¡ ç°åœ¨çš„è‡ªå·±</span>
              <span style="font-size: 11px; color: #999;">âš« æœªæ¥çš„è‡ªå·±</span>
            </div>
          `;
        }
        
        questionsHTML += `<div class="card"><p style="font-size: 15px; color: var(--text); margin: 0 0 16px; line-height: 1.6;">${idx + 1}. ${q.text}</p>${inputHTML}</div>`;
      });
      
      const allAnswered = section.questions.every(q => state.responses[q.id] !== undefined);
      
      return `
        <div class="page active">
          <div class="header">
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <h2>${section.title}</h2>
              <span style="font-size: 13px; opacity: 0.8;">${state.questionnaireSection + 1}/${QUESTIONNAIRE_SECTIONS.length}</span>
            </div>
            <div class="progress-bar"><div class="progress-fill" style="width: ${progress}%;"></div></div>
            <p>${section.description}</p>
          </div>
          <div class="content">${questionsHTML}</div>
          <div class="footer">
            <button class="btn btn-primary" ${allAnswered ? '' : 'disabled'} onclick="nextQuestionnaireSection()">
              ${state.questionnaireSection < QUESTIONNAIRE_SECTIONS.length - 1 ? 'ä¸‹ä¸€éƒ¨åˆ†' : 'å®Œæˆé—®å·'}
            </button>
          </div>
        </div>
      `;
    }
    
    function handleOptionSelect(questionId, optionIndex) {
      const section = QUESTIONNAIRE_SECTIONS[state.questionnaireSection];
      const question = section.questions.find(q => q.id === questionId);
      if (question && question.options) {
        state.responses[questionId] = question.options[optionIndex];
        render();
      }
    }
    
    function selectLikert(questionId, value) {
      state.responses[questionId] = value;
      render();
    }
    
    function nextQuestionnaireSection() {
      if (state.questionnaireSection < QUESTIONNAIRE_SECTIONS.length - 1) {
        state.questionnaireSection++;
        render();
        window.scrollTo(0, 0);
      } else {
        goToPage('demographics');
      }
    }

    // ==================== äººå£ç»Ÿè®¡ ====================
    function renderDemographics() {
      const questions = [
        { id: 'age', text: 'æ‚¨çš„å¹´é¾„', type: 'input', placeholder: 'è¯·è¾“å…¥å¹´é¾„' },
        { id: 'gender', text: 'æ‚¨çš„æ€§åˆ«', type: 'single', options: ['ç”·', 'å¥³', 'å…¶ä»–'] },
        { id: 'education', text: 'æ‚¨çš„æœ€é«˜å­¦å†', type: 'single', options: ['åˆä¸­åŠä»¥ä¸‹', 'é«˜ä¸­/ä¸­ä¸“', 'å¤§ä¸“', 'æœ¬ç§‘', 'ç¡•å£«åŠä»¥ä¸Š'] },
        { id: 'gig_experience', text: 'æ‚¨æ˜¯å¦æœ‰è¿‡å¤–å–éª‘æ‰‹æˆ–ç±»ä¼¼é…é€å·¥ä½œç»éªŒï¼Ÿ', type: 'single', options: ['æœ‰', 'æ²¡æœ‰'] }
      ];
      
      let questionsHTML = questions.map((q, idx) => {
        let inputHTML = '';
        if (q.type === 'input') {
          inputHTML = `<input type="text" placeholder="${q.placeholder}" value="${state.responses[q.id] || ''}" onchange="saveResponse('${q.id}', this.value); checkDemographics();">`;
        } else {
          inputHTML = `<div style="display: flex; flex-wrap: wrap; gap: 10px;">
            ${q.options.map((opt, optIdx) => `
              <div class="option ${state.responses[q.id] === opt ? 'selected' : ''}" onclick="handleDemoSelect('${q.id}', ${optIdx}, '${q.id}')" style="flex: 0 0 auto; padding: 12px 20px;">
                <span class="option-text">${opt}</span>
              </div>
            `).join('')}
          </div>`;
        }
        return `<div class="card"><p style="font-size: 15px; color: var(--text); margin: 0 0 16px;">${idx + 1}. ${q.text}</p>${inputHTML}</div>`;
      }).join('');
      
      const allAnswered = questions.every(q => state.responses[q.id] !== undefined && state.responses[q.id] !== '');
      
      return `
        <div class="page active">
          <div class="header"><h2>åŸºæœ¬ä¿¡æ¯</h2><p>æœ€åå‡ ä¸ªé—®é¢˜ï¼Œé©¬ä¸Šå®Œæˆï¼</p></div>
          <div class="content">${questionsHTML}</div>
          <div class="footer"><button class="btn btn-primary" id="submit-btn" ${allAnswered ? '' : 'disabled'} onclick="submitExperiment()">æäº¤é—®å·</button></div>
        </div>
      `;
    }
    
    const demoOptions = {
      gender: ['ç”·', 'å¥³', 'å…¶ä»–'],
      education: ['åˆä¸­åŠä»¥ä¸‹', 'é«˜ä¸­/ä¸­ä¸“', 'å¤§ä¸“', 'æœ¬ç§‘', 'ç¡•å£«åŠä»¥ä¸Š'],
      gig_experience: ['æœ‰', 'æ²¡æœ‰']
    };
    
    function handleDemoSelect(questionId, optionIndex, optionType) {
      const options = demoOptions[optionType];
      if (options) {
        state.responses[questionId] = options[optionIndex];
        render();
      }
    }
    
    function checkDemographics() {
      const allAnswered = ['age', 'gender', 'education', 'gig_experience'].every(q => state.responses[q] !== undefined && state.responses[q] !== '');
      const btn = $('#submit-btn');
      if (btn) btn.disabled = !allAnswered;
    }

    // ==================== æäº¤ä¸å®Œæˆ ====================
    function renderSubmitting() {
      return `
        <div class="page active" style="background: var(--header-gradient); justify-content: center; align-items: center; padding: 40px;">
          <div class="loading-spinner" style="width: 60px; height: 60px; border-width: 5px;"></div>
          <p style="margin-top: 24px; font-size: 18px; color: var(--secondary);">æ­£åœ¨æäº¤æ•°æ®...</p>
        </div>
      `;
    }

    function renderComplete() {
      return `
        <div class="page active complete-page">
          <div class="complete-icon">ğŸ‰</div>
          <h1 style="font-size: 28px; font-weight: 700; color: var(--secondary); margin: 0 0 20px;">æ„Ÿè°¢æ‚¨çš„å‚ä¸ï¼</h1>
          <p style="font-size: 16px; color: var(--secondary); opacity: 0.8; line-height: 1.8; margin: 0;">
            æ‚¨çš„å›ç­”å·²æˆåŠŸæäº¤<br>
            ç¥æ‚¨å·¥ä½œé¡ºåˆ©ï¼
          </p>
          <p style="font-size: 13px; color: var(--secondary); opacity: 0.5; margin-top: 60px;">
            ä¸­å—è´¢ç»æ”¿æ³•å¤§å­¦ Â· å·¥å•†ç®¡ç†å­¦é™¢
          </p>
        </div>
      `;
    }
    
    async function submitExperiment() {
      if (state.submitting) return;
      state.submitting = true;
      
      state.responses.endTime = new Date().toISOString();
      goToPage('submitting');
      
      const data = {
        participantId: state.participantId,
        platform: CONFIG.PLATFORM,
        startTime: state.startTime,
        endTime: state.responses.endTime,
        condition: {
          key: state.condition.key,
          explanation: state.condition.explanation,
          contextAwareness: state.condition.contextAwareness
        },
        device: state.deviceInfo,
        responses: state.responses
      };
      
      try { await submitData(data); } catch (e) { console.error('æäº¤å‡ºé”™:', e); }
      setTimeout(() => goToPage('complete'), 1000);
    }

    // ==================== åˆå§‹åŒ– ====================
    async function init() {
      state.deviceInfo = await generateDeviceInfo();
      $('#loading').style.display = 'none';
      render();
    }
    
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
